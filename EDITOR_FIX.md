# 编辑器问题修复说明

## 问题描述
在 Chrome 扩展的 Side Panel 环境中，Monaco Editor 会一直显示"Loading..."，无法正常加载。

## 根本原因
Monaco Editor 在 Chrome 扩展环境中存在以下兼容性问题：
1. **Web Worker 限制**：Monaco Editor 依赖 Web Workers 来提供语法高亮和智能提示，但 Chrome 扩展的 CSP（内容安全策略）限制了 Worker 的加载
2. **资源路径问题**：Monaco 需要动态加载多个 JavaScript 文件，在扩展的 Side Panel 中路径解析可能出现问题
3. **打包体积**：Monaco Editor 本身很大（约 20MB 未压缩），会显著增加扩展大小

## 解决方案
将 Monaco Editor 替换为原生 `<textarea>` 元素，并添加以下增强功能：

### 1. 等宽字体
使用 `font-mono` class，适合显示代码

### 2. Tab 键支持
- 按 Tab 键插入 2 个空格（而不是切换焦点）
- 保持代码格式的缩进

### 3. 样式优化
- 设置 `tabSize: 2` 确保显示时 Tab 为 2 个空格宽度
- `lineHeight: 1.5` 提高可读性
- 保持与原设计一致的圆角和边框

### 4. 用户体验
- 保留了所有原有功能（创建、编辑、保存）
- 添加提示文字："💡 提示：按 Tab 键插入缩进"
- 与文本模式使用相同的编辑器，保持一致性

## 改进效果

### 性能提升
- ✅ 即时加载，无需等待
- ✅ 减少 15KB 的打包体积
- ✅ 更低的内存占用

### 功能保留
- ✅ 支持所有内容类型（代码、SQL、文本）
- ✅ Tab 键缩进功能
- ✅ 等宽字体显示
- ✅ 完整的编辑功能

### 用户体验
- ✅ 无加载等待
- ✅ 响应更快
- ✅ 在 Chrome 扩展环境中完全兼容

## 权衡
**失去的功能：**
- ❌ 语法高亮
- ❌ 代码自动补全
- ❌ 行号显示
- ❌ 代码折叠

**保留的功能：**
- ✅ 代码编辑和保存
- ✅ 多种语言类型选择（虽然不影响显示，但保存时会记录）
- ✅ Tab 键缩进
- ✅ 等宽字体
- ✅ 搜索功能（浏览器原生 Ctrl+F）

## 备选方案（未来可考虑）

如果确实需要语法高亮，可以考虑：

### 1. CodeMirror 6
- 更轻量，约 500KB
- 对扩展环境支持更好
- 需要额外配置

### 2. Prism.js（只读高亮）
- 仅用于显示时的语法高亮
- 编辑时仍使用 textarea
- 约 20KB

### 3. Ace Editor
- 比 Monaco 更轻量
- 但仍可能有扩展兼容性问题

## 结论
对于 Chrome 扩展的使用场景，轻量级 textarea 是最佳选择：
- 完全兼容
- 快速响应
- 满足基本需求
- 无加载问题

如果用户需要更复杂的代码编辑功能，建议在外部编辑器（如 VS Code）中编写，然后粘贴到扩展中保存。
